{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,mBCAlF,MAAM,EAA+BI,OAAOC,KAAKC,OAAO,a,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,wC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,+B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,gC,aCEnCC,EAAc,WAMjC,SAAAA,EAAYC,EAAUC,GAAe,KALrCC,MAAQ,KAAI,KACZC,cAAWC,EAAS,KACpBJ,cAAQ,OACRC,mBAAa,EAGXI,KAAKL,SAAWA,EAChBK,KAAKJ,cAAgBA,CACvB,CAAC,IAAAK,EAAAP,EAAAN,UAuCA,OAvCAa,EAEDC,OAAA,SAAOC,EAASC,GAAkC,IAAAC,EAAA,UAAX,IAAvBD,IAAAA,EAA0B,QACnCE,OAAOC,YAEZP,KAAKF,SAAWQ,OAAOC,UAAUL,OAAOC,EAAS,CAC/CK,QAASC,IAAAA,MAAUC,UAAU,8BAC7BN,MAAAA,EACAO,KAAM,SACNhB,SAAU,SAACE,GACTQ,EAAKR,MAAQA,EACbQ,EAAKV,SAASE,EAChB,EACA,mBAAoB,WAClBQ,EAAKR,MAAQ,IACf,EACA,iBAAkB,WAChBQ,EAAKR,MAAQ,KACbQ,EAAKT,cAAc,CACjBgB,KAAM,QACNC,QAASJ,IAAAA,WAAeK,MAAM,kCAElC,IAEJ,EAACb,EAEDc,YAAA,WACE,OAAOf,KAAKH,KACd,EAACI,EAEDe,MAAA,WACMhB,KAAKF,WACPQ,OAAOC,UAAUS,MAAMhB,KAAKF,UAC5BE,KAAKH,MAAQ,KAEjB,EAACI,EAEDgB,QAAA,WACE,YAAmC,IAArBX,OAAOC,SACvB,EAACb,CAAA,CAhDgC,GCFnC,SAASwB,EAAgBC,EAAGC,GAC1B,OAAOF,EAAkBpC,OAAOuC,eAAiBvC,OAAOuC,eAAeC,OAAS,SAAUH,EAAGC,GAC3F,OAAOD,EAAEI,UAAYH,EAAGD,CAC1B,EAAGD,EAAgBC,EAAGC,EACxB,CCJA,MAAM,EAA+B7B,OAAOC,KAAKC,OAAO,oB,ICGnC+B,EAAS,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAA,KAAAC,YAAA,KCF9B,IAAwBR,EAAGtC,IDEG4C,GCFNN,EDEMK,GCD1BpC,UAAYN,OAAO8C,OAAO/C,EAAEO,WAAY+B,EAAE/B,UAAUyC,YAAcV,EAAGE,EAAeF,EAAGtC,GDC7D,IAAAoB,EAAAuB,EAAApC,UAgC3B,OAhC2Ba,EAC5B6B,SAAA,SAASC,GACPN,EAAArC,UAAM0C,SAAQxC,KAAC,KAAAyC,GAEf,IAAM3B,EAAQJ,KAAKgC,cAEnBhC,KAAKiC,MAAMC,MAAMhC,OAAO6B,EAAMI,IAAIC,cAAc,iBAAkBhC,EACpE,EAACH,EAED+B,YAAA,WAAgC,IAAAK,EAAAC,EACxBC,EAA6C,OAArCF,EAAG9C,OAAOiD,WAAW,uBAAgB,EAAlCH,EAAoCE,SAC/CE,EAA2C,OAArCH,EAAG/C,OAAOiD,WAAW,uBAAgB,EAAlCF,EAAoCG,OAEnD,GAAIF,GAAYE,EAAQ,CACtB,IAAIC,EAAeH,IAMnB,OAJIG,IAAiBD,EAAOE,OAC1BD,EAAepC,OAAOsC,WAAW,+BAA+BC,QAAUJ,EAAOK,KAAOL,EAAOM,OAG1FL,IAAiBD,EAAOK,KAAO,OAAS,OACjD,CAEA,OAASrC,IAAAA,MAAUC,UAAU,uBAAyB,OAAS,OACjE,EAACT,EAED+C,KAAA,WACE,OACEC,EAAA,OAAKC,UAAU,cACbD,EAAA,OAAKC,UAAU,iBAGrB,EAAC1B,CAAA,CAhC2B,C,MAAS2B,IEMjCC,EAA0B,SAAHC,GAQvB,IAPJC,EAAKD,EAALC,MACA1C,EAAIyC,EAAJzC,KACA2C,EAAUF,EAAVE,WAMMC,EAAY,WAAH,QAAW/C,IAAAA,MAAUC,UAAU,qBAAqBE,EAAO,GAE1E6C,EAAAA,EAAAA,QAAOH,EAAMlE,UAAW,UAAU,WAAY,IAAAiB,EAAA,KACvCmD,MAELxD,KAAKO,UAAY,IAAIb,GACnB,WAAO,IACP,SAACgE,GACY,MAAXrD,EAAKsD,QAALtD,EAAKsD,SACLtD,EAAKqD,WAAaA,CACpB,IAEJ,KAEAD,EAAAA,EAAAA,QAAOH,EAAMlE,UAAWmE,GAAY,SAAUK,GACvCJ,MACLI,EAAKC,eAAiB7D,KAAKO,UAAUQ,cACvC,KAEA0C,EAAAA,EAAAA,QAAOH,EAAMlE,UAAW,UAAU,SAAU0E,GACrCN,KACLM,EAAOC,IAAI,YAAad,EAACzB,EAAS,CAACU,MAAOlC,KAAKO,aAAgB,EACjE,KAEAkD,EAAAA,EAAAA,QAAOH,EAAMlE,UAAW,WAAW,SAAU4E,EAAGC,GAAO,IAAAC,EAChDV,MAELxD,KAAKO,UAAUS,SAEXiD,EAAME,OAAWF,EAAME,MAAMtD,SAAYoD,EAAME,MAAMtD,QAAQuD,SAC/DH,EAAME,MAAMtD,QAAUJ,IAAAA,WAAeK,MAAM,6CAG7Cd,KAAK0D,WAAaO,EAAME,MACxBlB,EAAEoB,SACU,OAAZH,EAAAlE,KAAKsE,UAALJ,EAAA5E,KAAAU,MACF,GACF,ECpDAS,IAAAA,aAAiBsD,IAAI,qBAAqB,WDuDxCX,EAAwB,CACtBE,MAAOiB,IACP3D,KAAM,SACN2C,WAAY,kBAGdH,EAAwB,CACtBE,MAAOkB,IACP5D,KAAM,SACN2C,WAAY,gBAGdH,EAAwB,CACtBE,MAAOmB,IACP7D,KAAM,SACN2C,WAAY,cCpEhB,G","sources":["webpack://flectar-flarum-turnstile/webpack/bootstrap","webpack://flectar-flarum-turnstile/webpack/runtime/compat get default export","webpack://flectar-flarum-turnstile/webpack/runtime/define property getters","webpack://flectar-flarum-turnstile/webpack/runtime/hasOwnProperty shorthand","webpack://flectar-flarum-turnstile/external root \"flarum.core.compat['forum/app']\"","webpack://flectar-flarum-turnstile/external root \"flarum.core.compat['common/extend']\"","webpack://flectar-flarum-turnstile/external root \"flarum.core.compat['forum/components/ForgotPasswordModal']\"","webpack://flectar-flarum-turnstile/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://flectar-flarum-turnstile/external root \"flarum.core.compat['forum/components/SignUpModal']\"","webpack://flectar-flarum-turnstile/./src/common/states/TurnstileState.ts","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://flectar-flarum-turnstile/external root \"flarum.core.compat['common/Component']\"","webpack://flectar-flarum-turnstile/./src/forum/components/Turnstile.tsx","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://flectar-flarum-turnstile/./src/forum/extendAuthModals.tsx","webpack://flectar-flarum-turnstile/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ForgotPasswordModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SignUpModal'];","import app from 'flarum/forum/app';\r\n\r\nexport default class TurnstileState {\r\n  token = null;\r\n  widgetId = undefined;\r\n  callback;\r\n  errorCallback;\r\n\r\n  constructor(callback, errorCallback) {\r\n    this.callback = callback;\r\n    this.errorCallback = errorCallback;\r\n  }\r\n\r\n  render(element, theme: 'light' | 'dark' = 'auto') {\r\n    if (!window.turnstile) return;\r\n\r\n    this.widgetId = window.turnstile.render(element, {\r\n      sitekey: app.forum.attribute('flectar-turnstile.site_key'),\r\n      theme,\r\n      size: 'normal',\r\n      callback: (token) => {\r\n        this.token = token;\r\n        this.callback(token);\r\n      },\r\n      'expired-callback': () => {\r\n        this.token = null;\r\n      },\r\n      'error-callback': () => {\r\n        this.token = null;\r\n        this.errorCallback({\r\n          type: 'error',\r\n          content: app.translator.trans('flectar-turnstile.forum.error'),\r\n        });\r\n      },\r\n    });\r\n  }\r\n\r\n  getResponse() {\r\n    return this.token;\r\n  }\r\n\r\n  reset() {\r\n    if (this.widgetId) {\r\n      window.turnstile.reset(this.widgetId);\r\n      this.token = null;\r\n    }\r\n  }\r\n\r\n  isReady() {\r\n    return typeof window.turnstile !== 'undefined';\r\n  }\r\n}\r\n","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","import Component from 'flarum/common/Component';\r\nimport app from 'flarum/forum/app';\r\n\r\nexport default class Turnstile extends Component<{ state: any }> {\r\n  oncreate(vnode) {\r\n    super.oncreate(vnode);\r\n\r\n    const theme = this.detectTheme();\r\n\r\n    this.attrs.state.render(vnode.dom.querySelector('.cf-turnstile'), theme);\r\n  }\r\n\r\n  detectTheme(): 'light' | 'dark' {\r\n    const getTheme = flarum.extensions['fof-nightmode']?.getTheme;\r\n    const Themes = flarum.extensions['fof-nightmode']?.Themes;\r\n\r\n    if (getTheme && Themes) {\r\n      let currentTheme = getTheme();\r\n\r\n      if (currentTheme === Themes.AUTO) {\r\n        currentTheme = window.matchMedia('(prefers-color-scheme:dark)').matches ? Themes.DARK : Themes.LIGHT;\r\n      }\r\n\r\n      return currentTheme === Themes.DARK ? 'dark' : 'light';\r\n    }\r\n\r\n    return !!app.forum.attribute('turnstile_dark_mode') ? 'dark' : 'light';\r\n  }\r\n\r\n  view() {\r\n    return (\r\n      <div className=\"Form-group\">\r\n        <div className=\"cf-turnstile\" />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","import app from 'flarum/forum/app';\r\nimport { extend, override } from 'flarum/common/extend';\r\nimport ForgotPasswordModal from 'flarum/forum/components/ForgotPasswordModal';\r\nimport LogInModal from 'flarum/forum/components/LogInModal';\r\nimport SignUpModal from 'flarum/forum/components/SignUpModal';\r\n\r\nimport TurnstileState from '../common/states/TurnstileState';\r\nimport Turnstile from './components/Turnstile';\r\n\r\nconst addTurnstileToAuthModal = <T extends typeof ForgotPasswordModal | typeof LogInModal | typeof SignUpModal>({\r\n  modal,\r\n  type,\r\n  dataMethod,\r\n}: {\r\n  modal: T;\r\n  type: 'forgot' | 'signin' | 'signup';\r\n  dataMethod: 'requestParams' | 'loginParams' | 'submitData';\r\n}) => {\r\n  const isEnabled = () => !!app.forum.attribute(`flectar-turnstile.${type}`);\r\n\r\n  extend(modal.prototype, 'oninit', function () {\r\n    if (!isEnabled()) return;\r\n\r\n    this.turnstile = new TurnstileState(\r\n      () => {},\r\n      (alertAttrs) => {\r\n        this.loaded?.();\r\n        this.alertAttrs = alertAttrs;\r\n      }\r\n    );\r\n  });\r\n\r\n  extend(modal.prototype, dataMethod, function (data) {\r\n    if (!isEnabled()) return;\r\n    data.turnstileToken = this.turnstile.getResponse();\r\n  });\r\n\r\n  extend(modal.prototype, 'fields', function (fields) {\r\n    if (!isEnabled()) return;\r\n    fields.add('turnstile', <Turnstile state={this.turnstile} />, -5);\r\n  });\r\n\r\n  extend(modal.prototype, 'onerror', function (_, error) {\r\n    if (!isEnabled()) return;\r\n\r\n    this.turnstile.reset();\r\n\r\n    if (error.alert && (!error.alert.content || !error.alert.content.length)) {\r\n      error.alert.content = app.translator.trans('flectar-turnstile.forum.validation_error');\r\n    }\r\n\r\n    this.alertAttrs = error.alert;\r\n    m.redraw();\r\n    this.onready?.();\r\n  });\r\n};\r\n\r\nexport default function extendAuthModalsWithTurnstile() {\r\n  addTurnstileToAuthModal({\r\n    modal: ForgotPasswordModal,\r\n    type: 'forgot',\r\n    dataMethod: 'requestParams',\r\n  });\r\n\r\n  addTurnstileToAuthModal({\r\n    modal: LogInModal,\r\n    type: 'signin',\r\n    dataMethod: 'loginParams',\r\n  });\r\n\r\n  addTurnstileToAuthModal({\r\n    modal: SignUpModal,\r\n    type: 'signup',\r\n    dataMethod: 'submitData',\r\n  });\r\n}\r\n","import app from 'flarum/forum/app';\r\nimport extendAuthModalsWithTurnstile from './extendAuthModals';\r\n\r\napp.initializers.add('flectar/turnstile', () => {\r\n  extendAuthModalsWithTurnstile();\r\n});\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","TurnstileState","callback","errorCallback","token","widgetId","undefined","this","_proto","render","element","theme","_this","window","turnstile","sitekey","app","attribute","size","type","content","trans","getResponse","reset","isReady","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","Turnstile","_Component","apply","arguments","create","constructor","oncreate","vnode","detectTheme","attrs","state","dom","querySelector","_flarum$extensions$fo","_flarum$extensions$fo2","getTheme","extensions","Themes","currentTheme","AUTO","matchMedia","matches","DARK","LIGHT","view","m","className","Component","addTurnstileToAuthModal","_ref","modal","dataMethod","isEnabled","extend","alertAttrs","loaded","data","turnstileToken","fields","add","_","error","_this$onready","alert","length","redraw","onready","ForgotPasswordModal","LogInModal","SignUpModal"],"sourceRoot":""}