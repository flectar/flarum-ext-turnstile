{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://flectar-flarum-turnstile/./src/forum/ lazy namespace object","webpack://flectar-flarum-turnstile/webpack/bootstrap","webpack://flectar-flarum-turnstile/webpack/runtime/compat get default export","webpack://flectar-flarum-turnstile/webpack/runtime/define property getters","webpack://flectar-flarum-turnstile/webpack/runtime/hasOwnProperty shorthand","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://flectar-flarum-turnstile/./src/common/states/TurnstileState.ts","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'common/Component')\"","webpack://flectar-flarum-turnstile/./src/forum/components/Turnstile.tsx","webpack://flectar-flarum-turnstile/./src/forum/extendAuthModals.tsx"],"sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 619;\nmodule.exports = webpackEmptyAsyncContext;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\tflarum.reg._webpack_runtimes[\"flectar-turnstile\"] ||= __webpack_require__;// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport default class TurnstileState {\n  constructor(callback, errorCallback) {\n    _defineProperty(this, \"token\", null);\n    _defineProperty(this, \"widgetId\", undefined);\n    _defineProperty(this, \"callback\", void 0);\n    _defineProperty(this, \"errorCallback\", void 0);\n    this.callback = callback;\n    this.errorCallback = errorCallback;\n  }\n  render(element, theme) {\n    if (theme === void 0) {\n      theme = 'auto';\n    }\n    if (!window.turnstile) return;\n    this.widgetId = window.turnstile.render(element, {\n      sitekey: flarum.forum.attribute('flectar-turnstile.site_key'),\n      theme,\n      size: 'normal',\n      callback: token => {\n        this.token = token;\n        this.callback(token);\n      },\n      'expired-callback': () => {\n        this.token = null;\n      },\n      'error-callback': () => {\n        this.token = null;\n        this.errorCallback({\n          type: 'error',\n          content: flarum.translator.trans('flectar-turnstile.forum.error')\n        });\n      }\n    });\n  }\n  getResponse() {\n    return this.token;\n  }\n  reset() {\n    if (this.widgetId) {\n      window.turnstile.reset(this.widgetId);\n      this.token = null;\n    }\n  }\n  isReady() {\n    return typeof window.turnstile !== 'undefined';\n  }\n}\nflarum.reg.add('flectar-turnstile', 'common/states/TurnstileState', TurnstileState);","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/Component');","import Component from 'flarum/common/Component';\nexport default class Turnstile extends Component {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    const theme = this.detectTheme();\n    this.attrs.state.render(vnode.dom.querySelector('.cf-turnstile'), theme);\n  }\n  detectTheme() {\n    const currentTheme = document.documentElement.dataset.theme || 'light';\n    return currentTheme.startsWith('dark') ? 'dark' : 'light';\n  }\n  view() {\n    return m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"div\", {\n      className: \"cf-turnstile\"\n    }));\n  }\n}\nflarum.reg.add('flectar-turnstile', 'forum/components/Turnstile', Turnstile);","import { override } from 'flarum/common/extend';\nimport TurnstileState from '../common/states/TurnstileState';\nimport Turnstile from './components/Turnstile';\nconst addTurnstileToAuthModal = _ref => {\n  let {\n    modulePath,\n    type,\n    dataMethod\n  } = _ref;\n  import(modulePath).then(module => {\n    const modal = module.default;\n    const isEnabled = () => !!flarum.forum.attribute(`flectar-turnstile.${type}`);\n    override(modal.prototype, 'oninit', function (original) {\n      original();\n      if (!isEnabled()) return;\n      this.turnstile = new TurnstileState(() => {}, alertAttrs => {\n        this.loaded?.();\n        this.alertAttrs = alertAttrs;\n      });\n    });\n    override(modal.prototype, dataMethod, function (original) {\n      const data = original();\n      if (!isEnabled()) return data;\n      data.turnstileToken = this.turnstile.getResponse();\n      return data;\n    });\n    override(modal.prototype, 'fields', function (original) {\n      const fields = original();\n      if (!isEnabled()) return fields;\n      const priority = modulePath.includes('ChangePasswordModal') ? 10 : -5;\n      fields.add('turnstile', m(Turnstile, {\n        state: this.turnstile\n      }), priority);\n      return fields;\n    });\n    override(modal.prototype, 'onerror', function (original, error) {\n      original(error);\n      if (!isEnabled()) return;\n      this.turnstile.reset();\n      if (error.alert && (!error.alert.content || !error.alert.content.length)) {\n        error.alert.content = flarum.translator.trans('flectar-turnstile.forum.validation_error');\n      }\n      this.alertAttrs = error.alert;\n      this.onready?.();\n    });\n  });\n};\nexport default function extendAuthModalsWithTurnstile() {\n  addTurnstileToAuthModal({\n    modulePath: 'flarum/forum/components/ForgotPasswordModal',\n    type: 'forgot',\n    dataMethod: 'requestParams'\n  });\n  addTurnstileToAuthModal({\n    modulePath: 'flarum/forum/components/LogInModal',\n    type: 'signin',\n    dataMethod: 'loginParams'\n  });\n  addTurnstileToAuthModal({\n    modulePath: 'flarum/forum/components/SignUpModal',\n    type: 'signup',\n    dataMethod: 'submitData'\n  });\n  addTurnstileToAuthModal({\n    modulePath: 'flarum/forum/components/ChangePasswordModal',\n    type: 'forgot',\n    dataMethod: 'requestBody'\n  });\n}"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","id","module","exports","__webpack_module_cache__","__webpack_require__","moduleId","flarum","reg","_webpack_runtimes","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_typeof","Symbol","iterator","constructor","_defineProperty","r","t","i","toPrimitive","TypeError","String","toPropertyKey","value","configurable","writable","TurnstileState","callback","errorCallback","this","render","element","theme","window","turnstile","widgetId","sitekey","forum","attribute","size","token","type","content","translator","trans","getResponse","reset","isReady","add","Turnstile","oncreate","vnode","super","detectTheme","attrs","state","dom","querySelector","document","documentElement","dataset","startsWith","view","m","className","addTurnstileToAuthModal","_ref","modulePath","dataMethod","modal","default","isEnabled","override","original","alertAttrs","loaded","data","turnstileToken","fields","priority","includes","error","alert","length","onready"],"sourceRoot":""}