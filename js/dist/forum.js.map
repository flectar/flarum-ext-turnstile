{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@flectar/flarum-turnstile/webpack/bootstrap","webpack://@flectar/flarum-turnstile/webpack/runtime/compat get default export","webpack://@flectar/flarum-turnstile/webpack/runtime/define property getters","webpack://@flectar/flarum-turnstile/webpack/runtime/hasOwnProperty shorthand","webpack://@flectar/flarum-turnstile/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://@flectar/flarum-turnstile/external root \"flarum.reg.get('core', 'forum/app')\"","webpack://@flectar/flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://@flectar/flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://@flectar/flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://@flectar/flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://@flectar/flarum-turnstile/./src/common/states/TurnstileState.ts","webpack://@flectar/flarum-turnstile/external root \"flarum.reg.get('core', 'common/Component')\"","webpack://@flectar/flarum-turnstile/./src/forum/components/Turnstile.tsx","webpack://@flectar/flarum-turnstile/./src/forum/extendAuthModals.tsx","webpack://@flectar/flarum-turnstile/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/app');","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nexport default class TurnstileState {\n  constructor(callback, errorCallback) {\n    _defineProperty(this, \"token\", null);\n    _defineProperty(this, \"widgetId\", undefined);\n    _defineProperty(this, \"callback\", void 0);\n    _defineProperty(this, \"errorCallback\", void 0);\n    this.callback = callback;\n    this.errorCallback = errorCallback;\n  }\n  render(element, theme) {\n    if (theme === void 0) {\n      theme = 'auto';\n    }\n    if (!window.turnstile) return;\n    this.widgetId = window.turnstile.render(element, {\n      sitekey: app.forum.attribute('flectar-turnstile.site_key'),\n      theme,\n      size: 'flexible',\n      callback: token => {\n        this.token = token;\n        this.callback(token);\n      },\n      'expired-callback': () => {\n        this.token = null;\n      },\n      'error-callback': () => {\n        this.token = null;\n        this.errorCallback({\n          type: 'error',\n          content: app.translator.trans('flectar-turnstile.forum.error')\n        });\n      }\n    });\n  }\n  getResponse() {\n    return this.token;\n  }\n  reset() {\n    if (this.widgetId) {\n      window.turnstile.reset(this.widgetId);\n      this.token = null;\n    }\n  }\n  isReady() {\n    return typeof window.turnstile !== 'undefined';\n  }\n}\nflarum.reg.add('flectar-turnstile', 'common/states/TurnstileState', TurnstileState);","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/Component');","import Component from 'flarum/common/Component';\nexport default class Turnstile extends Component {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    const theme = this.detectTheme();\n    this.attrs.state.render(vnode.dom.querySelector('.cf-turnstile'), theme);\n  }\n  detectTheme() {\n    const currentTheme = document.documentElement.dataset.theme || 'light';\n    return currentTheme.startsWith('dark') ? 'dark' : 'light';\n  }\n  view() {\n    return m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"div\", {\n      className: \"cf-turnstile\"\n    }));\n  }\n}\nflarum.reg.add('flectar-turnstile', 'forum/components/Turnstile', Turnstile);","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport TurnstileState from '../common/states/TurnstileState';\nimport Turnstile from './components/Turnstile';\nexport default function extendAuthModalsWithTurnstile() {\n  const isEnabled = type => !!app.forum.attribute(`flectar-turnstile.${type}`);\n  const applyExtenders = (modulePath, type, dataMethod) => {\n    extend(modulePath, 'oninit', function () {\n      if (!isEnabled(type)) return;\n      this.turnstile = new TurnstileState(() => {}, alertAttrs => {\n        this.loaded?.();\n        this.alertAttrs = alertAttrs;\n      });\n    });\n    extend(modulePath, dataMethod, function (data) {\n      if (!isEnabled(type)) return;\n      data.turnstileToken = this.turnstile.getResponse();\n    });\n    extend(modulePath, 'fields', function (items) {\n      if (!isEnabled(type)) return;\n      const priority = modulePath.includes('ChangePasswordModal') ? 10 : -5;\n      items.add('turnstile', m(Turnstile, {\n        state: this.turnstile\n      }), priority);\n    });\n    extend(modulePath, 'onerror', function (_, error) {\n      if (!isEnabled(type)) return;\n      this.turnstile.reset();\n      if (error.alert && !error.alert.content?.length) {\n        error.alert.content = app.translator.trans('flectar-turnstile.forum.validation_error');\n      }\n    });\n  };\n  applyExtenders('flarum/forum/components/ForgotPasswordModal', 'forgot', 'requestParams');\n  applyExtenders('flarum/forum/components/LogInModal', 'signin', 'loginParams');\n  applyExtenders('flarum/forum/components/SignUpModal', 'signup', 'submitData');\n  applyExtenders('flarum/forum/components/ChangePasswordModal', 'forgot', 'requestBody');\n}","import extendAuthModalsWithTurnstile from './extendAuthModals';\nextendAuthModalsWithTurnstile();"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","reg","_typeof","Symbol","iterator","constructor","_defineProperty","e","r","t","i","toPrimitive","TypeError","String","toPropertyKey","value","configurable","writable","TurnstileState","callback","errorCallback","this","undefined","render","element","theme","window","turnstile","widgetId","sitekey","attribute","size","token","type","content","trans","getResponse","reset","isReady","add","Turnstile","oncreate","vnode","super","detectTheme","attrs","state","dom","querySelector","document","documentElement","dataset","startsWith","view","m","className","isEnabled","applyExtenders","modulePath","dataMethod","extend","alertAttrs","loaded","data","turnstileToken","items","priority","includes","_","error","alert","length","extendAuthModalsWithTurnstile"],"sourceRoot":""}