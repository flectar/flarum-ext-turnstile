{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://flectar-flarum-turnstile/webpack/bootstrap","webpack://flectar-flarum-turnstile/webpack/runtime/compat get default export","webpack://flectar-flarum-turnstile/webpack/runtime/define property getters","webpack://flectar-flarum-turnstile/webpack/runtime/hasOwnProperty shorthand","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'forum/components/ForgotPasswordModal')\"","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'forum/components/LogInModal')\"","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'forum/components/SignUpModal')\"","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'forum/components/ChangePasswordModal')\"","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://flectar-flarum-turnstile/./src/common/states/TurnstileState.ts","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'common/Component')\"","webpack://flectar-flarum-turnstile/./src/forum/components/Turnstile.tsx","webpack://flectar-flarum-turnstile/./src/forum/extendAuthModals.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/components/ForgotPasswordModal');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/components/LogInModal');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/components/SignUpModal');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/components/ChangePasswordModal');","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport default class TurnstileState {\n  constructor(callback, errorCallback) {\n    _defineProperty(this, \"token\", null);\n    _defineProperty(this, \"widgetId\", undefined);\n    _defineProperty(this, \"callback\", void 0);\n    _defineProperty(this, \"errorCallback\", void 0);\n    this.callback = callback;\n    this.errorCallback = errorCallback;\n  }\n  render(element, theme) {\n    if (theme === void 0) {\n      theme = 'auto';\n    }\n    if (!window.turnstile) return;\n    this.widgetId = window.turnstile.render(element, {\n      sitekey: flarum.forum.attribute('flectar-turnstile.site_key'),\n      theme,\n      size: 'normal',\n      callback: token => {\n        this.token = token;\n        this.callback(token);\n      },\n      'expired-callback': () => {\n        this.token = null;\n      },\n      'error-callback': () => {\n        this.token = null;\n        this.errorCallback({\n          type: 'error',\n          content: flarum.translator.trans('flectar-turnstile.forum.error')\n        });\n      }\n    });\n  }\n  getResponse() {\n    return this.token;\n  }\n  reset() {\n    if (this.widgetId) {\n      window.turnstile.reset(this.widgetId);\n      this.token = null;\n    }\n  }\n  isReady() {\n    return typeof window.turnstile !== 'undefined';\n  }\n}\nflarum.reg.add('flectar-turnstile', 'common/states/TurnstileState', TurnstileState);","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/Component');","import Component from 'flarum/common/Component';\nexport default class Turnstile extends Component {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    const theme = this.detectTheme();\n    this.attrs.state.render(vnode.dom.querySelector('.cf-turnstile'), theme);\n  }\n  detectTheme() {\n    const getTheme = flarum.extensions['fof-nightmode']?.getTheme;\n    const Themes = flarum.extensions['fof-nightmode']?.Themes;\n    if (getTheme && Themes) {\n      let currentTheme = getTheme();\n      if (currentTheme === Themes.AUTO) {\n        currentTheme = window.matchMedia('(prefers-color-scheme:dark)').matches ? Themes.DARK : Themes.LIGHT;\n      }\n      return currentTheme === Themes.DARK ? 'dark' : 'light';\n    }\n    const isDark = flarum.forum.attributes.themeDarkMode;\n    return isDark ? 'dark' : 'light';\n  }\n  view() {\n    return m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"div\", {\n      className: \"cf-turnstile\"\n    }));\n  }\n}\nflarum.reg.add('flectar-turnstile', 'forum/components/Turnstile', Turnstile);","import { override } from 'flarum/common/extend';\nimport ForgotPasswordModal from 'flarum/forum/components/ForgotPasswordModal';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport SignUpModal from 'flarum/forum/components/SignUpModal';\nimport ChangePasswordModal from 'flarum/forum/components/ChangePasswordModal';\nimport TurnstileState from '../common/states/TurnstileState';\nimport Turnstile from './components/Turnstile';\nconst addTurnstileToAuthModal = _ref => {\n  let {\n    modal,\n    type,\n    dataMethod\n  } = _ref;\n  const isEnabled = () => !!flarum.forum.attribute(`flectar-turnstile.${type}`);\n  override(modal.prototype, 'oninit', function (original) {\n    original();\n    if (!isEnabled()) return;\n    this.turnstile = new TurnstileState(() => {}, alertAttrs => {\n      this.loaded?.();\n      this.alertAttrs = alertAttrs;\n    });\n  });\n  override(modal.prototype, dataMethod, function (original) {\n    const data = original();\n    if (!isEnabled()) return data;\n    data.turnstileToken = this.turnstile.getResponse();\n    return data;\n  });\n  override(modal.prototype, 'fields', function (original) {\n    const fields = original();\n    if (!isEnabled()) return fields;\n    fields.add('turnstile', m(Turnstile, {\n      state: this.turnstile\n    }), this instanceof ChangePasswordModal ? 10 : -5);\n    return fields;\n  });\n  override(modal.prototype, 'onerror', function (original, error) {\n    original(error);\n    if (!isEnabled()) return;\n    this.turnstile.reset();\n    if (error.alert && (!error.alert.content || !error.alert.content.length)) {\n      error.alert.content = flarum.translator.trans('flectar-turnstile.forum.validation_error');\n    }\n    this.alertAttrs = error.alert;\n    this.onready?.();\n  });\n};\nexport default function extendAuthModalsWithTurnstile() {\n  addTurnstileToAuthModal({\n    modal: ForgotPasswordModal,\n    type: 'forgot',\n    dataMethod: 'requestParams'\n  });\n  addTurnstileToAuthModal({\n    modal: LogInModal,\n    type: 'signin',\n    dataMethod: 'loginParams'\n  });\n  addTurnstileToAuthModal({\n    modal: SignUpModal,\n    type: 'signup',\n    dataMethod: 'submitData'\n  });\n  addTurnstileToAuthModal({\n    modal: ChangePasswordModal,\n    type: 'forgot',\n    dataMethod: 'requestBody'\n  });\n}"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","reg","_typeof","Symbol","iterator","constructor","_defineProperty","e","r","t","i","toPrimitive","TypeError","String","toPropertyKey","value","configurable","writable","TurnstileState","callback","errorCallback","this","undefined","render","element","theme","window","turnstile","widgetId","sitekey","forum","attribute","size","token","type","content","translator","trans","getResponse","reset","isReady","add","Turnstile","oncreate","vnode","super","detectTheme","attrs","state","dom","querySelector","getTheme","extensions","Themes","currentTheme","AUTO","matchMedia","matches","DARK","LIGHT","attributes","themeDarkMode","view","m","className","addTurnstileToAuthModal","_ref","modal","dataMethod","isEnabled","override","original","alertAttrs","loaded","data","turnstileToken","fields","error","alert","length","onready"],"sourceRoot":""}