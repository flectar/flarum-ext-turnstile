{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://flectar-flarum-turnstile/webpack/bootstrap","webpack://flectar-flarum-turnstile/webpack/runtime/compat get default export","webpack://flectar-flarum-turnstile/webpack/runtime/define property getters","webpack://flectar-flarum-turnstile/webpack/runtime/hasOwnProperty shorthand","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://flectar-flarum-turnstile/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://flectar-flarum-turnstile/./src/common/states/TurnstileState.ts","webpack://flectar-flarum-turnstile/external root \"flarum.reg.get('core', 'common/Component')\"","webpack://flectar-flarum-turnstile/./src/forum/components/Turnstile.tsx","webpack://flectar-flarum-turnstile/./src/forum/extendAuthModals.tsx","webpack://flectar-flarum-turnstile/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport default class TurnstileState {\n  constructor(callback, errorCallback) {\n    _defineProperty(this, \"token\", null);\n    _defineProperty(this, \"widgetId\", undefined);\n    _defineProperty(this, \"callback\", void 0);\n    _defineProperty(this, \"errorCallback\", void 0);\n    this.callback = callback;\n    this.errorCallback = errorCallback;\n  }\n  render(element, theme) {\n    if (theme === void 0) {\n      theme = 'auto';\n    }\n    if (!window.turnstile) return;\n    this.widgetId = window.turnstile.render(element, {\n      sitekey: flarum.forum.attribute('flectar-turnstile.site_key'),\n      theme,\n      size: 'normal',\n      callback: token => {\n        this.token = token;\n        this.callback(token);\n      },\n      'expired-callback': () => {\n        this.token = null;\n      },\n      'error-callback': () => {\n        this.token = null;\n        this.errorCallback({\n          type: 'error',\n          content: flarum.translator.trans('flectar-turnstile.forum.error')\n        });\n      }\n    });\n  }\n  getResponse() {\n    return this.token;\n  }\n  reset() {\n    if (this.widgetId) {\n      window.turnstile.reset(this.widgetId);\n      this.token = null;\n    }\n  }\n  isReady() {\n    return typeof window.turnstile !== 'undefined';\n  }\n}\nflarum.reg.add('flectar-turnstile', 'common/states/TurnstileState', TurnstileState);","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/Component');","import Component from 'flarum/common/Component';\nexport default class Turnstile extends Component {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    const theme = this.detectTheme();\n    this.attrs.state.render(vnode.dom.querySelector('.cf-turnstile'), theme);\n  }\n  detectTheme() {\n    const currentTheme = document.documentElement.dataset.theme || 'light';\n    return currentTheme.startsWith('dark') ? 'dark' : 'light';\n  }\n  view() {\n    return m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"div\", {\n      className: \"cf-turnstile\"\n    }));\n  }\n}\nflarum.reg.add('flectar-turnstile', 'forum/components/Turnstile', Turnstile);","import { override } from 'flarum/common/extend';\nimport TurnstileState from '../common/states/TurnstileState';\nimport Turnstile from './components/Turnstile';\nexport default function extendAuthModalsWithTurnstile() {\n  const isEnabled = type => !!flarum.forum.attribute(`flectar-turnstile.${type}`);\n  const applyOverrides = (modulePath, type, dataMethod) => {\n    override(modulePath, 'oninit', function (original) {\n      original();\n      if (!isEnabled(type)) return;\n      this.turnstile = new TurnstileState(() => {}, alertAttrs => {\n        this.loaded?.();\n        this.alertAttrs = alertAttrs;\n      });\n    });\n    override(modulePath, dataMethod, function (original) {\n      const data = original();\n      if (!isEnabled(type)) return data;\n      data.turnstileToken = this.turnstile.getResponse();\n      return data;\n    });\n    override(modulePath, 'fields', function (original) {\n      const fields = original();\n      if (!isEnabled(type)) return fields;\n      const priority = modulePath.includes('ChangePasswordModal') ? 10 : -5;\n      fields.add('turnstile', m(Turnstile, {\n        state: this.turnstile\n      }), priority);\n      return fields;\n    });\n    override(modulePath, 'onerror', function (original, error) {\n      original(error);\n      if (!isEnabled(type)) return;\n      this.turnstile.reset();\n      if (error.alert && !error.alert.content?.length) {\n        error.alert.content = flarum.translator.trans('flectar-turnstile.forum.validation_error');\n      }\n      this.alertAttrs = error.alert;\n      this.onready?.();\n    });\n  };\n  applyOverrides('flarum/forum/components/ForgotPasswordModal', 'forgot', 'requestParams');\n  applyOverrides('flarum/forum/components/LogInModal', 'signin', 'loginParams');\n  applyOverrides('flarum/forum/components/SignUpModal', 'signup', 'submitData');\n  applyOverrides('flarum/forum/components/ChangePasswordModal', 'forgot', 'requestBody');\n}","import extendAuthModalsWithTurnstile from './extendAuthModals';\nextendAuthModalsWithTurnstile();"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","reg","_typeof","Symbol","iterator","constructor","_defineProperty","e","r","t","i","toPrimitive","TypeError","String","toPropertyKey","value","configurable","writable","TurnstileState","callback","errorCallback","this","undefined","render","element","theme","window","turnstile","widgetId","sitekey","forum","attribute","size","token","type","content","translator","trans","getResponse","reset","isReady","add","Turnstile","oncreate","vnode","super","detectTheme","attrs","state","dom","querySelector","document","documentElement","dataset","startsWith","view","m","className","isEnabled","applyOverrides","modulePath","dataMethod","override","original","alertAttrs","loaded","data","turnstileToken","fields","priority","includes","error","alert","length","onready","extendAuthModalsWithTurnstile"],"sourceRoot":""}