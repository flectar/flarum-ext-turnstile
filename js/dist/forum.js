(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.reg.get("core","common/extend"),r=flarum.reg.get("core","forum/components/ForgotPasswordModal");var o=t.n(r);const n=flarum.reg.get("core","forum/components/LogInModal");var a=t.n(n);const i=flarum.reg.get("core","forum/components/SignUpModal");var s=t.n(i);const l=flarum.reg.get("core","forum/components/ChangePasswordModal");var u=t.n(l);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function d(t,e,r){return(e=function(t){var e=function(t){if("object"!=c(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==c(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class f{constructor(t,e){d(this,"token",null),d(this,"widgetId",void 0),d(this,"callback",void 0),d(this,"errorCallback",void 0),this.callback=t,this.errorCallback=e}render(t,e){void 0===e&&(e="auto"),window.turnstile&&(this.widgetId=window.turnstile.render(t,{sitekey:flarum.forum.attribute("flectar-turnstile.site_key"),theme:e,size:"normal",callback:t=>{this.token=t,this.callback(t)},"expired-callback":()=>{this.token=null},"error-callback":()=>{this.token=null,this.errorCallback({type:"error",content:flarum.translator.trans("flectar-turnstile.forum.error")})}}))}getResponse(){return this.token}reset(){this.widgetId&&(window.turnstile.reset(this.widgetId),this.token=null)}isReady(){return void 0!==window.turnstile}}flarum.reg.add("flectar-turnstile","common/states/TurnstileState",f);const h=flarum.reg.get("core","common/Component");var p=t.n(h);class g extends(p()){oncreate(t){super.oncreate(t);const e=this.detectTheme();this.attrs.state.render(t.dom.querySelector(".cf-turnstile"),e)}detectTheme(){return(document.documentElement.dataset.theme||"light").startsWith("dark")?"dark":"light"}view(){return m("div",{className:"Form-group"},m("div",{className:"cf-turnstile"}))}}flarum.reg.add("flectar-turnstile","forum/components/Turnstile",g);const y=t=>{let{modal:r,type:o,dataMethod:n}=t;const a=()=>!!flarum.forum.attribute(`flectar-turnstile.${o}`);(0,e.override)(r.prototype,"oninit",(function(t){t(),a()&&(this.turnstile=new f((()=>{}),(t=>{this.loaded?.(),this.alertAttrs=t})))})),(0,e.override)(r.prototype,n,(function(t){const e=t();return a()?(e.turnstileToken=this.turnstile.getResponse(),e):e})),(0,e.override)(r.prototype,"fields",(function(t){const e=t();return a()?(e.add("turnstile",m(g,{state:this.turnstile}),this instanceof u()?10:-5),e):e})),(0,e.override)(r.prototype,"onerror",(function(t,e){t(e),a()&&(this.turnstile.reset(),!e.alert||e.alert.content&&e.alert.content.length||(e.alert.content=flarum.translator.trans("flectar-turnstile.forum.validation_error")),this.alertAttrs=e.alert,this.onready?.())}))};y({modal:o(),type:"forgot",dataMethod:"requestParams"}),y({modal:a(),type:"signin",dataMethod:"loginParams"}),y({modal:s(),type:"signup",dataMethod:"submitData"}),y({modal:u(),type:"forgot",dataMethod:"requestBody"})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map