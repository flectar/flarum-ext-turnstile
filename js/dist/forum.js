(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var r=t.n(e);const o=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/components/ForgotPasswordModal"];var a=t.n(n);const i=flarum.core.compat["forum/components/LogInModal"];var l=t.n(i);const s=flarum.core.compat["forum/components/SignUpModal"];var c=t.n(s);const u=flarum.core.compat["forum/components/ChangePasswordModal"];var d=t.n(u),f=function(){function t(t,e){this.token=null,this.widgetId=void 0,this.callback=void 0,this.errorCallback=void 0,this.callback=t,this.errorCallback=e}var e=t.prototype;return e.render=function(t,e){var o=this;void 0===e&&(e="auto"),window.turnstile&&(this.widgetId=window.turnstile.render(t,{sitekey:r().forum.attribute("flectar-turnstile.site_key"),theme:e,size:"normal",callback:function(t){o.token=t,o.callback(t)},"expired-callback":function(){o.token=null},"error-callback":function(){o.token=null,o.errorCallback({type:"error",content:r().translator.trans("flectar-turnstile.forum.error")})}}))},e.getResponse=function(){return this.token},e.reset=function(){this.widgetId&&(window.turnstile.reset(this.widgetId),this.token=null)},e.isReady=function(){return void 0!==window.turnstile},t}();function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}const h=flarum.core.compat["common/Component"];var v=function(t){function e(){return t.apply(this,arguments)||this}var o,n;n=t,(o=e).prototype=Object.create(n.prototype),o.prototype.constructor=o,p(o,n);var a=e.prototype;return a.oncreate=function(e){t.prototype.oncreate.call(this,e);var r=this.detectTheme();this.attrs.state.render(e.dom.querySelector(".cf-turnstile"),r)},a.detectTheme=function(){var t,e,o=null==(t=flarum.extensions["fof-nightmode"])?void 0:t.getTheme,n=null==(e=flarum.extensions["fof-nightmode"])?void 0:e.Themes;if(o&&n){var a=o();return a===n.AUTO&&(a=window.matchMedia("(prefers-color-scheme:dark)").matches?n.DARK:n.LIGHT),a===n.DARK?"dark":"light"}return r().forum.attribute("turnstile_dark_mode")?"dark":"light"},a.view=function(){return m("div",{className:"Form-group"},m("div",{className:"cf-turnstile"}))},e}(t.n(h)()),y=function(t){var e=t.modal,n=t.type,a=t.dataMethod,i=function(){return!!r().forum.attribute("flectar-turnstile."+n)};(0,o.extend)(e.prototype,"oninit",(function(){var t=this;i()&&(this.turnstile=new f((function(){}),(function(e){null==t.loaded||t.loaded(),t.alertAttrs=e})))})),(0,o.extend)(e.prototype,a,(function(t){i()&&(t.turnstileToken=this.turnstile.getResponse())})),(0,o.extend)(e.prototype,"fields",(function(t){i()&&t.add("turnstile",m(v,{state:this.turnstile}),this instanceof d()?10:-5)})),(0,o.extend)(e.prototype,"onerror",(function(t,e){var o;i()&&(this.turnstile.reset(),!e.alert||e.alert.content&&e.alert.content.length||(e.alert.content=r().translator.trans("flectar-turnstile.forum.validation_error")),this.alertAttrs=e.alert,m.redraw(),null==(o=this.onready)||o.call(this))}))};r().initializers.add("flectar/turnstile",(function(){y({modal:a(),type:"forgot",dataMethod:"requestParams"}),y({modal:l(),type:"signin",dataMethod:"loginParams"}),y({modal:c(),type:"signup",dataMethod:"submitData"}),y({modal:d(),type:"forgot",dataMethod:"requestBody"})}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map